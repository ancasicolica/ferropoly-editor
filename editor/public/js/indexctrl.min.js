"use strict";var indexControl=angular.module("indexApp",["ui.bootstrap"]);indexControl.controller("indexCtrl",["$scope","$http",function(a,b){a.gameplays=[];var c;a.gameplayToDelete;var d=function(){b.get("/authtoken").success(function(a){c=a.authToken,console.log("Auth ok")}).error(function(b,c){console.log("error:"),console.log(b),console.log(c),a.panel="error",a.errorMessage="Authentisierungsfehler. Status: "+c})};$(document).ready(function(){b.get("/gameplay/mygames").success(function(b){a.gameplays=b.success?b.gameplays:[],console.log(b),console.log("Gameplays loaded, nb:"+a.gameplays.length),a.gameplays.forEach(function(a){var b=new Date(a.log.lastEdited);console.log(b),console.log(a.log.lastEdited)}),d()}).error(function(b,c){console.log("error:"),console.log(b),console.log(c),a.gameplays=[]})}),a.prepareToDelete=function(b){a.gameplayToDelete=b.gameplay},a.deleteGameplay=function(){return a.gameplayToDelete?void b.post("/gameplay/delete",{gameId:a.gameplayToDelete.internal.gameId,authToken:c}).success(function(b){b.success?(console.log("gameplay deleted"),console.log(b),_.remove(a.gameplays,function(b){return b.internal.gameId===a.gameplayToDelete.internal.gameId}),a.statusText="Spiel gelöscht: "+a.gameplayToDelete.gamename,a.gameplayToDelete=null):(console.log("Error"),console.log(b),a.statusText="Spiel konnte nicht gelöscht werden: "+a.gameplayToDelete.gamename,a.gameplayToDelete=null)}).error(function(b,c){console.log("ERROR"),console.log(b),console.log(c),a.statusText="Spiel konnte nicht gelöscht werden: "+a.gameplayToDelete.gamename,a.gameplayToDelete=null}):void console.log("no gameplay to delete")}}]);