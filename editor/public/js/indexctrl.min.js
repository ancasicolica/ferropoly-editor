/*! Ferropoly-Editor V0.7.2 15-08-2015, (c) Christian Kuster, CH-8342 Wernetshausen, christian@kusti.ch> */
"use strict";var indexControl=angular.module("indexApp",["ui.bootstrap"]);indexControl.controller("indexCtrl",["$scope","$http",function($scope,$http){$scope.gameplays=[];var authToken;$scope.gameplayToDelete;var getAuthToken=function(){$http.get("/authtoken").success(function(data){authToken=data.authToken;console.log("Auth ok")}).error(function(data,status){console.log("error:");console.log(data);console.log(status);$scope.panel="error";$scope.errorMessage="Authentisierungsfehler. Status: "+status})};$(document).ready(function(){$http.get("/gameplay/mygames").success(function(data){if(data.success){$scope.gameplays=data.gameplays}else{$scope.gameplays=[]}console.log(data);console.log("Gameplays loaded, nb:"+$scope.gameplays.length);$scope.gameplays.forEach(function(gp){var d=new Date(gp.log.lastEdited);console.log(d);console.log(gp.log.lastEdited)});getAuthToken()}).error(function(data,status){console.log("error:");console.log(data);console.log(status);$scope.gameplays=[]})});$scope.prepareToDelete=function(obj){$scope.gameplayToDelete=obj.gameplay};$scope.deleteGameplay=function(){if(!$scope.gameplayToDelete){console.log("no gameplay to delete");return}$http.post("/gameplay/delete",{gameId:$scope.gameplayToDelete.internal.gameId,authToken:authToken}).success(function(data){if(data.success){console.log("gameplay deleted");console.log(data);_.remove($scope.gameplays,function(gp){return gp.internal.gameId===$scope.gameplayToDelete.internal.gameId});$scope.statusText="Spiel gelöscht: "+$scope.gameplayToDelete.gamename;$scope.gameplayToDelete=null}else{console.log("Error");console.log(data);$scope.statusText="Spiel konnte nicht gelöscht werden: "+$scope.gameplayToDelete.gamename;$scope.gameplayToDelete=null}}).error(function(data,status){console.log("ERROR");console.log(data);console.log(status);$scope.statusText="Spiel konnte nicht gelöscht werden: "+$scope.gameplayToDelete.gamename;$scope.gameplayToDelete=null})}}]);