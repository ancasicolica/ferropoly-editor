/*! Ferropoly-Editor V0.9.4 17-09-2015, (c) Christian Kuster, CH-8342 Wernetshausen, christian@kusti.ch> */
var signupControl=angular.module("signupApp",["ui.bootstrap"]);signupControl.controller("signupCtrl",["$scope","$http","$interval",function($scope,$http,$interval){var socket=null;$scope.view=0;$scope.email=undefined;$scope.forename=undefined;$scope.surname=undefined;$scope.password=undefined;$scope.passwordVerify=undefined;$scope.agbAccepted=false;$scope.emailInvalid=false;$scope.passwordInvalid=false;$scope.passwordRepeatInvalid=false;$scope.surenameInvalid=false;$scope.forenameInvalid=false;$scope.emailInvalidExplanation="";$scope.emailSent=false;var setValidationClasses=function(valid,id){if(valid){$(id).removeClass("has-success");$(id).addClass("has-error")}else{$(id).removeClass("has-error");$(id).addClass("has-success")}};$scope.finalSendButtonDisabled=function(){if(!$scope.agbAccepted){return true}return $scope.emailSent};var onEmailVerificationResult=function(data){console.log(data);setValidationClasses(!data.valid,"#email-group");if(!data.valid){$scope.emailInvalid=true;if(data.inUse){$scope.emailInvalidExplanation="Die Email-Adresse ist bereits in Gebrauch, eine Registrierung ist nicht möglich!"}else if(data.message){$scope.emailInvalidExplanation=data.message}else if(!$scope.email||$scope.email.length===0){$scope.emailInvalidExplanation="Eine Email-Adresse ist notwendig."}else{$scope.emailInvalidExplanation="Die Email-Adresse ist ungültig."}}else{$scope.emailInvalid=false}};$(document).ready(function(){setAgbHeight()});var setAgbHeight=function(){var dh=$(window).height();var mc=document.querySelector("#agb-box");var h=dh-195;mc.style.height=h.toString()+"px"};$scope.verifyEmail=function(){$http.post("/signup/verifyemail",{email:$scope.email}).success(function(data){onEmailVerificationResult(data)}).error(function(data,status){console.log(status);onEmailVerificationResult(data)})};$scope.verifyForename=function(){$scope.forenameInvalid=!$scope.forename||$scope.forename.length<3;setValidationClasses($scope.forenameInvalid,"#forename-group")};$scope.verifySurname=function(){$scope.surnameInvalid=!$scope.surname||$scope.surname.length<3;setValidationClasses($scope.surnameInvalid,"#surname-group")};$scope.verifyPassword=function(){$scope.passwordInvalid=!$scope.password||$scope.password.length<8;setValidationClasses($scope.passwordInvalid,"#password-group")};$scope.verifyRepeatPassword=function(){$scope.passwordRepeatInvalid=!$scope.passwordVerify||$scope.password!==$scope.passwordVerify;setValidationClasses($scope.passwordRepeatInvalid,"#password-repeat-group")};$scope.formDataValid=function(){if($scope.emailInvalid||$scope.passwordInvalid||$scope.passwordRepeatInvalid||$scope.surenameInvalid||$scope.forenameInvalid){return false}return $scope.email&&$scope.forename&&$scope.surname&&$scope.password&&$scope.passwordVerify};$scope.createUser=function(){if($scope.formDataValid()){$scope.emailSent=true;$http.post("/signup/new",{personalData:{forename:$scope.forename,surname:$scope.surname,email:$scope.email},password:$scope.password}).success(function(data){console.log(data);if(data.saved){$scope.emailSentSuccess=true}else{$scope.emailError=data.message}$scope.view++;fa.event("Signup","new user",$scope.email)}).error(function(data,status){$scope.emailError=status;console.warn(status);console.log(data);$scope.view++})}}}]);