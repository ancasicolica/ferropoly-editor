/*! Ferropoly-Editor V2.4.2 04-08-2018, (c) Christian Kuster, CH-8342 Wernetshausen, christian@kusti.ch> */

"use strict";angular.module("adminsApp",[]).controller("adminsCtrl",["$scope","$http",function($scope,$http){var authToken="";$scope.adminInfo=adminInfo;$scope.logins=gameplay.admins.logins;$scope.saved=false;$scope.saveError="";$scope.changed=false;$scope.isExistingUser=function(index){if(_.isString($scope.logins[index])&&$scope.logins[index].length===0){return"empty"}return _.isObject($scope.adminInfo[$scope.logins[index]])};$scope.hasUserWithoutLogin=function(){if($scope.changed){return false}for(var i=0;i<3;i++){if(!$scope.isExistingUser(i)){return true}}return false};$scope.allDefinedUsersHaveLogin=function(){if(!$scope.changed){return false}var retVal=false;for(var i=0;i<3;i++){switch($scope.isExistingUser(i)){case true:retVal=true;break;case false:return false;case"empty":break}}return retVal};$scope.save=function(){$http.post("/admins/"+gameplay.gameId,{logins:$scope.logins,authToken:authToken}).then(function(resp){console.log("admins updated");fa.event("Admins","store",{gameId:gameId});$scope.adminInfo=resp.data.result;$scope.saved=true;$scope.changed=false;$scope.saveError=""},function(resp){console.error("/admins/save",resp);if(resp.status==401){genericModals.showError("Fehler","Gegenwärtig fehlt die Berechtigung für den Zugriff auf diese Seite.",resp,function(){window.location.href="/"})}else{genericModals.showError("Fehler","Beim Speichern der Admins trat ein Problem auf",resp)}$scope.saved=false;$scope.saveError=" der Server meldet Status "+status+" ("+resp.data+")"})};$scope.dataChanged=function(){$scope.saved=false;$scope.changed=true};$(document).ready(function(){$http.get("/authtoken").then(function(resp){authToken=resp.data.authToken;console.log("Auth ok")},function(resp){console.error("/authtoken",resp);genericModals.showError("Fehler","Die Berechtigung für diese Seite konnte nicht überpürft werden.",resp,function(){window.location.href="/"})})})}]);