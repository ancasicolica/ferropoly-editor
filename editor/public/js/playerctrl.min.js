"use strict";var generateUUID=function(){var a=(new Date).getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(b){var c=(a+16*Math.random())%16|0;return a=Math.floor(a/16),("x"==b?c:7&c|8).toString(16)})};angular.module("playerApp",[]).controller("playerCtrl",["$scope","$http",function(a,b){var c="";a.teams=[],a.currentTeam=void 0,a.currentDataChanged=!1,a.maxGroupNb=20,a.sortTeams=function(){a.teams=_.sortBy(a.teams,function(a){return a.data.name?a.data.name.toUpperCase():""})},a.setCurrentTeam=function(b){return a.currentTeam&&!a.playerForm.$valid?(console.log("invalid data, can not change the team"),void(a.statusText="Daten unvollstÃ¤ndig")):(a.currentDataChanged?a.saveTeam(function(c){c&&console.error(c),a.currentTeam=b,a.currentDataChanged=!1}):(a.currentTeam=b,a.currentDataChanged=!1),void _.delay(a.validateForm,500))},a.newTeam=function(){if(a.currentTeam&&!a.playerForm.$valid)return console.log("invalid data, can not add a team"),void(a.statusText="Zuerst aktuelles Team fertig bearbeiten");var b={data:{name:"Neue Gruppe"+a.teams.length},gameId:gameId,uuid:generateUUID()};a.teams.push(b),a.sortTeams(),a.currentTeam=b,_.delay(a.validateForm,500)},a.saveTeam=function(d){d||(d=function(a){console.log(a)}),b.post("/player/store",{team:a.currentTeam,authToken:c}).success(function(b){return b.success?(console.log("team updated"),a.statusText=a.currentTeam.data.name+" gespeichert",d(null)):(console.log("Error"),console.log(b),a.statusText="Fehler beim speichern",d(new Error(b.message)))}).error(function(b,c){return console.log("ERROR"),console.log(b),console.log(c),a.statusText="Fehler beim speichern",d(new Error(b.message))})},a.deleteTeam=function(){var d=a.teams.indexOf(a.currentTeam);b.post("/player/delete",{teamId:a.currentTeam.uuid,authToken:c}).success(function(b){console.log(b.success?"team deleted":"error while deleting: "+b),d>-1&&a.teams.splice(d,1),a.sortTeams(),a.currentTeam=void 0,a.teams.length>0&&a.setCurrentTeam(a.teams[0])}).error(function(a,b){console.log("ERROR"),console.log(a),console.log(b)})},a.validateForm=function(){a.playerForm.contactName.$valid?$("#contactName").addClass("valid-data").removeClass("invalid-data"):$("#contactName").addClass("invalid-data").removeClass("valid-data"),a.playerForm.name.$valid?$("#name").addClass("valid-data").removeClass("invalid-data"):$("#name").addClass("invalid-data").removeClass("valid-data"),a.playerForm.email.$valid?$("#email").addClass("valid-data").removeClass("invalid-data"):$("#email").addClass("invalid-data").removeClass("valid-data")},$(document).ready(function(){b.get("/authtoken").success(function(d){c=d.authToken,console.log("Auth ok"),b.get("/player/get?gameId="+gameId).success(function(b){console.log(b),a.teams=b.teams,a.sortTeams(),a.teams.length>0?a.setCurrentTeam(a.teams[0]):a.currentTeam=void 0,a.statusText="Daten geladen"}).error(function(b,c){a.statusText="Fehler beim Laden der Teams",console.log("load-game-error"),console.log(b),console.log(c)})}).error(function(b,c){console.log("error:"),console.log(b),console.log(c),a.statusText="Authentisierungsfehler"})})}]);